const N="https://stackblitz.com",b=["angular-cli","create-react-app","html","javascript","node","polymer","typescript","vue"],C=["project","search","ports","settings"],A=["light","dark"],D=["editor","preview"],S={clickToLoad:e=>l("ctl",e),devToolsHeight:e=>v("devtoolsheight",e),forceEmbedLayout:e=>l("embed",e),hideDevTools:e=>l("hidedevtools",e),hideExplorer:e=>l("hideExplorer",e),hideNavigation:e=>l("hideNavigation",e),openFile:e=>h("file",e),showSidebar:e=>O("showSidebar",e),sidebarView:e=>f("sidebarView",e,C),startScript:e=>h("startScript",e),terminalHeight:e=>v("terminalHeight",e),theme:e=>f("theme",e,A),view:e=>f("view",e,D),zenMode:e=>l("zenMode",e),organization:e=>`${h("orgName",e?.name)}&${h("orgProvider",e?.provider)}`,crossOriginIsolated:e=>l("corp",e)};function j(e={}){const t=Object.entries(e).map(([n,r])=>r!=null&&S.hasOwnProperty(n)?S[n](r):"").filter(Boolean);return t.length?`?${t.join("&")}`:""}function l(e,t){return t===!0?`${e}=1`:""}function O(e,t){return typeof t=="boolean"?`${e}=${t?"1":"0"}`:""}function v(e,t){if(typeof t=="number"&&!Number.isNaN(t)){const n=Math.min(100,Math.max(0,t));return`${e}=${encodeURIComponent(Math.round(n))}`}return""}function f(e,t="",n=[]){return n.includes(t)?`${e}=${encodeURIComponent(t)}`:""}function h(e,t){return(Array.isArray(t)?t:[t]).filter(r=>typeof r=="string"&&r.trim()!=="").map(r=>`${e}=${encodeURIComponent(r)}`).join("&")}function I(){return Math.random().toString(36).slice(2,6)+Math.random().toString(36).slice(2,6)}function g(e,t){return`${T(t)}${e}${j(t)}`}function _(e,t){const n={forceEmbedLayout:!0};return t&&typeof t=="object"&&Object.assign(n,t),`${T(n)}${e}${j(n)}`}function T(e={}){return(typeof e.origin=="string"?e.origin:N).replace(/\/$/,"")}function y(e,t,n){if(!t||!e||!e.parentNode)throw new Error("Invalid Element");e.id&&(t.id=e.id),e.className&&(t.className=e.className),L(t,n),M(e,t,n),e.replaceWith(t)}function E(e){if(typeof e=="string"){const t=document.getElementById(e);if(!t)throw new Error(`Could not find element with id '${e}'`);return t}else if(e instanceof HTMLElement)return e;throw new Error(`Invalid element: ${e}`)}function w(e){return e&&e.newWindow===!1?"_self":"_blank"}function L(e,t={}){const n=Object.hasOwnProperty.call(t,"height")?`${t.height}`:"300",r=Object.hasOwnProperty.call(t,"width")?`${t.width}`:void 0;e.setAttribute("height",n),r?e.setAttribute("width",r):e.setAttribute("style","width:100%;")}function M(e,t,n={}){const r=e.allow?.split(";")?.map(i=>i.trim())??[];n.crossOriginIsolated&&!r.includes("cross-origin-isolated")&&r.push("cross-origin-isolated"),r.length>0&&(t.allow=r.join("; "))}class F{constructor(t){this.pending={},this.port=t,this.port.onmessage=this.messageListener.bind(this)}request({type:t,payload:n}){return new Promise((r,i)=>{const o=I();this.pending[o]={resolve:r,reject:i},this.port.postMessage({type:t,payload:{...n,__reqid:o}})})}messageListener(t){if(typeof t.data.payload?.__reqid!="string")return;const{type:n,payload:r}=t.data,{__reqid:i,__success:o,__error:s}=r;this.pending[i]&&(o?this.pending[i].resolve(this.cleanResult(r)):this.pending[i].reject(s?`${n}: ${s}`:n),delete this.pending[i])}cleanResult(t){const n={...t};return delete n.__reqid,delete n.__success,delete n.__error,Object.keys(n).length?n:null}}class U{constructor(t,n){this.editor={openFile:r=>this._rdc.request({type:"SDK_OPEN_FILE",payload:{path:r}}),setCurrentFile:r=>this._rdc.request({type:"SDK_SET_CURRENT_FILE",payload:{path:r}}),setTheme:r=>this._rdc.request({type:"SDK_SET_UI_THEME",payload:{theme:r}}),setView:r=>this._rdc.request({type:"SDK_SET_UI_VIEW",payload:{view:r}}),showSidebar:(r=!0)=>this._rdc.request({type:"SDK_TOGGLE_SIDEBAR",payload:{visible:r}})},this.preview={origin:"",getUrl:()=>this._rdc.request({type:"SDK_GET_PREVIEW_URL",payload:{}}).then(r=>r?.url??null),setUrl:(r="/")=>{if(typeof r!="string"||!r.startsWith("/"))throw new Error(`Invalid argument: expected a path starting with '/', got '${r}'`);return this._rdc.request({type:"SDK_SET_PREVIEW_URL",payload:{path:r}})}},this._rdc=new F(t),Object.defineProperty(this.preview,"origin",{value:typeof n.previewOrigin=="string"?n.previewOrigin:null,writable:!1})}applyFsDiff(t){const n=r=>r!==null&&typeof r=="object";if(!n(t)||!n(t.create))throw new Error("Invalid diff object: expected diff.create to be an object.");if(!Array.isArray(t.destroy))throw new Error("Invalid diff object: expected diff.destroy to be an array.");return this._rdc.request({type:"SDK_APPLY_FS_DIFF",payload:t})}getDependencies(){return this._rdc.request({type:"SDK_GET_DEPS_SNAPSHOT",payload:{}})}getFsSnapshot(){return this._rdc.request({type:"SDK_GET_FS_SNAPSHOT",payload:{}})}}const p=[];class x{constructor(t){this.id=I(),this.element=t,this.pending=new Promise((n,r)=>{const i=({data:c,ports:d})=>{c?.action==="SDK_INIT_SUCCESS"&&c.id===this.id&&(this.vm=new U(d[0],c.payload),n(this.vm),s())},o=()=>{this.element.contentWindow?.postMessage({action:"SDK_INIT",id:this.id},"*")};function s(){window.clearInterval(u),window.removeEventListener("message",i)}window.addEventListener("message",i),o();let a=0;const u=window.setInterval(()=>{if(this.vm){s();return}if(a>=20){s(),r("Timeout: Unable to establish a connection with the StackBlitz VM"),p.forEach((c,d)=>{c.id===this.id&&p.splice(d,1)});return}a++,o()},500)}),p.push(this)}}const R=e=>{const t=e instanceof Element?"element":"id";return p.find(n=>n[t]===e)??null};function k(e,t){const n=document.createElement("input");return n.type="hidden",n.name=e,n.value=t,n}function H(e){return e.replace(/\[/g,"%5B").replace(/\]/g,"%5D")}function $({template:e,title:t,description:n,dependencies:r,files:i,settings:o}){if(!b.includes(e)){const c=b.map(d=>`'${d}'`).join(", ");console.warn(`Unsupported project.template: must be one of ${c}`)}const s=[],a=(c,d,P="")=>{s.push(k(c,typeof d=="string"?d:P))};a("project[title]",t),typeof n=="string"&&n.length>0&&a("project[description]",n),a("project[template]",e,"javascript"),r&&(e==="node"?console.warn("Invalid project.dependencies: dependencies must be provided as a 'package.json' file when using the 'node' template."):a("project[dependencies]",JSON.stringify(r))),o&&a("project[settings]",JSON.stringify(o)),Object.entries(i).forEach(([c,d])=>{a(`project[files][${H(c)}]`,d)});const u=document.createElement("form");return u.method="POST",u.setAttribute("style","display:none!important;"),u.append(...s),u}function q(e,t){const n=$(e);return n.action=_("/run",t),n.id="sb_run",`<!doctype html>
<html>
<head><title></title></head>
<body>
  ${n.outerHTML}
  <script>document.getElementById('${n.id}').submit();<\/script>
</body>
</html>`}function B(e,t){const n=$(e);n.action=g("/run",t),n.target=w(t),document.body.appendChild(n),n.submit(),document.body.removeChild(n)}function m(e){return e?.contentWindow?(R(e)??new x(e)).pending:Promise.reject("Provided element is not an iframe.")}function V(e,t){B(e,t)}function K(e,t){const n=g(`/edit/${e}`,t),r=w(t);window.open(n,r)}function G(e,t){const n=g(`/github/${e}`,t),r=w(t);window.open(n,r)}function W(e,t,n){const r=E(e),i=q(t,n),o=document.createElement("iframe");return y(r,o,n),o.contentDocument?.write(i),m(o)}function z(e,t,n){const r=E(e),i=document.createElement("iframe");return i.src=_(`/edit/${t}`,n),y(r,i,n),m(i)}function J(e,t,n){const r=E(e),i=document.createElement("iframe");return i.src=_(`/github/${t}`,n),y(r,i,n),m(i)}const X={connect:m,embedGithubProject:J,embedProject:W,embedProjectId:z,openGithubProject:G,openProject:V,openProjectId:K};document.querySelectorAll(".btn-edit").forEach(e=>{e.addEventListener("click",t=>{const n=t.target.closest(".btn-edit").nextElementSibling?.id;document.getElementById(`collapse_content_2_${n}`)?.classList.add("d-block"),document.getElementById(`${n}_viewCode`)?.classList.add("d-block");const r=document.getElementById(`${n}_html`).innerText,i=document.getElementById(`${n}_code`).innerText;document.getElementById(`collapse_content_2_${n}`)?.classList.remove("d-block"),document.getElementById(`${n}_viewCode`)?.classList.remove("d-block");const o=document.querySelector("[data-ods-charts-version]").getAttribute("data-ods-charts-version"),s=document.querySelector("[data-echarts-version]").getAttribute("data-echarts-version");Y(r,i,o,s)})});const Y=(e,t,n,r)=>{const i={files:{"index.html":`<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!--
      Neue Helvetica is a trademark of Monotype Imaging Inc. registered in the U.S.
      Patent and Trademark Office and may be registered in certain other jurisdictions.
      Copyright © 2014 Monotype Imaging Inc. All rights reserved.
      Orange has purchased the right to use Helvetica in its websites and mobile applications.
      If you are not authorized to used it, don’t include the orange-helvetica.css
      See NOTICE.txt for more information.
    -->
    <link href="https://cdn.jsdelivr.net/npm/boosted@5.3.7/dist/fonts/HelvNeue55_W1G.woff2" rel="preload" as="font" type="font/woff2" />
    <link href="https://cdn.jsdelivr.net/npm/boosted@5.3.7/dist/fonts/HelvNeue75_W1G.woff2" rel="preload" as="font" type="font/woff2" />
    <link href="https://cdn.jsdelivr.net/npm/boosted@5.3.7/dist/css/orange-helvetica.min.css" rel="stylesheet" />

    <link href="https://cdn.jsdelivr.net/npm/boosted@5.3.7/dist/css/boosted.min.css" rel="stylesheet" />
    <title>ODS Charts example</title>

    <script src="https://cdn.jsdelivr.net/npm/echarts@${r}/dist/echarts.min.js"><\/script>
    <script src="https://cdn.jsdelivr.net/npm/ods-charts@${n}/dist/ods-charts.min.js"><\/script>
  </head>
  <body class="p-3 m-0 border-0" style="height: 65vh;">
    <!-- Example Code -->
    ${e}
    <!-- End Example Code -->
  </body>
</html>`,"index.js":t},title:"ODS Charts example",description:`Official example from ${window.location.href}`,template:"javascript",tags:["ODS_Charts"]};X.openProject(i,{openFile:"index.js"})};
